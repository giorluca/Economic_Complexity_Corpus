Amenity complexity and urban locations of socio-economic mixing

Amenity complexity and urban locationsof socio-economic mixingSándor Juhász 1,2,3,*, Gergő Pintér 2, Ádám Kovács 3, Endre Borza 3,Gergely Mónus 2, László Lőrincz 2,3, and Balázs Lengyel 2,31Complexity Science Hub Vienna, Vienna, Austria2NETI Lab, Corvinus University of Budapest, Budapest, Hungary3ANET Lab, ELKH Center for Economic and Regional Sciences, Budapest, Hungary*Corresponding author: juhasz@csh.ac.atAbstractCities host diverse people and their mixing is the engine of prosperity. In turn, segregationand inequalities are common features of most cities and locations that enable the meeting ofpeople with different socio-economic status are key for urban inclusion. In this study, we adoptthe concept of economic complexity to quantify the ability of locations – on the level of neigh-borhoods and amenities – to attract diverse visitors from various socio-economic backgroundsacross the city. We construct the measures of neighborhood complexity and amenity complex-ity based on the local portfolio of diverse and non-ubiquitous amenities in Budapest, Hungary.Socio-economic mixing at visited third places is investigated by tracing the daily mobility ofindividuals and by characterizing their status by the real-estate price of their home locations.Results suggest that measures of ubiquity and diversity of amenities do not, but neighbor-hood complexity and amenity complexity are correlated with the urban centrality of locations.Urban centrality is a strong predictor of socio-economic mixing, but both neighborhood com-plexity and amenity complexity add further explanatory power to our models. Our work com-bines urban mobility data with economic complexity thinking to show that the diversity ofnon-ubiquitous amenities, central locations, and the potentials for socio-economic mixing areinterrelated.1 IntroductionDiversity is the key ingredient of successful and resilient cities (Jacobs 1961). The spatially concen-trated interaction of people from various social and economic background create environmentsthat foster creativity (Florida 2004), support inclusion (Benton-Short and Short 2013) and in gen-eral, make cities vivid and prosperous (Glaeser 2012). At the same time, cities show high levels ofsegregation such that individuals from different socio-economic background are separated fromeach other in the urban space (Musterd 2020). This phenomenon limits social mobility for many1arXiv:2212.07280v2  [physics.soc-ph]  21 Apr 2023(Mayer and Jencks 1989) and induced inequalities can expose segregated groups to health or cli-mate crises (Torrats-Espinosa 2021; Loughran and Elliott 2022) and can imply radicalization andpopulism (Abadie 2006; Engler and Weisstanner 2021).Recent studies leverage GPS mobility data to study socio-economic segregation and mixingpatterns in visited urban locations (Cagney et al. 2020). This growing literature frequently reportsthat people in cities visit and interact with locations that are similar to their residential neigh-borhood in terms of income, education, ethnicity or other socio-economic features (Wang, NolanEdward Phillips, and Sampson 2018; Dong et al. 2020; Bokányi et al. 2021; Hilman, Iñiguez, andKarsai 2022). However, the places, services or amenities that individuals visit in the city exhibitdifferent levels of experienced segregation, as some locations mix different socio-economic groupswhile others do not (Athey et al. 2021; Moro et al. 2021).In this study we characterize urban locations that foster socio-economic mixing and lower ex-perienced segregation by attracting people from diverse strata. To do so, we emphasize two aspectsof urban locations that can influence observed socio-economic mixing: their amenity portfolio andgeographical centrality in the city.The type of amenities available at a location determine its purpose and function and there-fore is related to experienced segregation. Noyman et al. (2019) illustrates through individual GPStrajectories that urban locations offering entertainment amenities, services or natural water fea-tures are visited by a more diverse set of people. Athey et al. (2021) describes that individualscan experience relatively low experienced segregation at outdoor places like parks, sports fieldsand playgrounds, or at commercial establishments such as restaurants, bars and retail stores. Theyfind that places of entertainment, like theaters and accommodations, like hotels are the least seg-regated urban locations. Moro et al. (2021) shows that the category of places is a strong predictorfor experienced income segregation and unique places in cities, such as arts venues, museums orairports tend to be highly integrative, while places that primarily serve local communities, such asgrocery stores or places of worship are generally more segregated by income. Yet, urban locationscan be hardly described by single amenity types; instead, they typically host more types of ameni-ties. Despite previous empirical efforts, systematic examination on how the mixture of amenitiesat specific urban locations contribute to social mixing is still missing from the literature.Specialized amenities that serve the specific needs of the wider public and therefore can attractpeople from diverse neighborhoods tend to situate in the center of cities. The central place theoryoriginally developed for the inter-urban scale by Christaller (1933) and Lösch (1954) explains thehierarchy of cities and towns through their size and the range of functions that they provide andhas been used to study the functions of locations within cities too (see for example (Wang 2021)).Higher-order centers attract population from a larger area, because they not only share most of thefunctions of lower order centers, but also host some more specialized functions too. Building onthe central place theory, Zhong et al. (2017) combines density, the number of people attracted tolocations and diversity, the range of activities that they engage with at these locations in a singlecentrality measure to identify urban centers in Singapore and illustrate their evolution over time.2Noyman et al. (2019) shows that urban locations with higher centrality in urban road networksattract more diverse visitors. On the contrary, Moro et al. (2021) presents that urban locations withhigher average travel distance to them tend to be less segregated than locations that are highlyaccessible. While most of the studies highlight that accessible, central locations attract more diversevisitors, yet, the nature of the available amenity mix might be related to the position of locations,which has not been focused on so far.Here, we aim to extend the above literature by investigating how the amenity mix and cen-tral position of urban locations are related to experienced segregation or, put it differently, to themixing of people from diverse socio-economic strata. A new contribution is the application ofthe economic complexity framework to urban amenities (Hidalgo 2021) to quantify the ability oflocations – on the level of neighborhoods and amenities as well – in attracting visitors of diversesocio-economic status from across the city.The concept of economic complexity is originally developed by Hidalgo and Hausmann (2009)who defined complexity of economies by the diversity of their non-ubiquitous products and ser-vices. Economic complexity is indicative of countries economic growth, income level, emissionsand inequalities (Hidalgo 2021). By now, the concept is applied to different data sources suchas patents, occupations or scientific publications and to diverse spatial scales from countries tocities (Balland et al. 2022; Magalhães et al. 2023). Here we adopt the measurement technique touncover the complexity of neighborhoods and amenities. We propose that a neighborhood has acomplex amenity mix in case it offers diverse set of amenities of those types that are barely presentat other locations. On the contrary, complex amenities are those that only few neighborhoods arespecialized into and are co-located with similarly non-ubiquitous amenities. Unlike in the origi-nal framework of economic complexity that captures the knowledge and capabilities required toachieve economic outputs (Hidalgo and Hausmann 2009), our approach does not address the pro-ductive and operative knowledge that a given location has accumulated (Hidalgo 2021). Instead,we measure the sophistication of local amenity supply that can serve a diverse demand and attractdiverse socio-economic groups.The rational to apply neighborhood and amenity complexity to understand mixing of peopleis based on two reasons. First, diverse amenity mixes in neighborhoods can attract people with di-verse demands. Second, locations with non-ubiquitous amenities can attract people from diverseneighborhoods, as the particular service is hard to find elsewhere. Consequently, complex ameni-ties are also expected to attract diverse visitors. Therefore, our hypothesis is that the diverse mix ofnon-ubiquitous amenities can create an inclusive, multipurpose neighborhood that is most likelyto be attractive for a wide-variety of people. While the contribution of amenity mix to the socio-economic diversity of visitors at urban locations has rarely been unveiled, diverse amenities areargued to concentrate in and attract people to central places of cities (Zhong et al. 2017). To betterunderstand the connection between neighborhood and amenity complexity, urban centrality andsocio-economic mixing, we test their correlation with the socio-economic diversity of visitors.We test this argument in Budapest, the capital of Hungary by combining point of interests (POI)3data collected from the Google Places API and individual mobility trajectories collected by a GPSaggregator company. Building on the work of Hidalgo, Castañer, and Sevtsuk (2020), we constructthe indicators of neighborhood and amenity complexity by utilizing the geographic distribution ofPOIs in neighborhoods. We identify home, work and third place visits in daily mobility trajectoriesfor 24 months by clustering the geolocated pings of devices in geographical space and over time(Oldenburg 1999). We combine the information of predicted home locations with real estate pricesat the census tract level. This allows us to investigate third place visits and to infer the socio-economic diversity of visitors in each urban neighborhood and in each actual amenity.Our results illustrate that, in the monocentric city of Budapest, specialization and diversity ofamenities do not, but amenity complexity is correlated with urban centrality. We find that socio-economic mixing increases as neighborhood complexity grows, and that amenity complexity isalso associated with lower levels of experienced segregation. These suggest that the combinationof mobility data with economic complexity thinking can provide new insights to the research ofurban segregation and mixing.2 Tracing mobility inside citiesUrban mobility of individuals are studied by using raw GPS data from a data aggregator company.We can trace the daily mobility of 5.2 million devices in Hungary over 24 months (between 2019June and 2021 May). We initially filter this data to focus on devices that appear inside Budapestand have at least 20 GPS pings in total after discarding pings which indicate unreasonably highspeeds of device mobility. Detailed description on the mobility data preparation process can befound in section 1 of the Supplementary information.We process raw trajectories of individuals by applying the Infostop algorithm (Aslak andAlessandretti 2020). It enables us to detect the stationary points of individual movements andcluster GPS pings around stop locations. Figure 1A-B illustrates the raw data and the outcome ofstop detection through an example device. The algorithm gives each stop a label indicating a placethat can reoccur along the trajectory of the device. We focus on devices with at least 2 distinctplaces and 10 stops in a month inside Budapest. Using the monthly recurrence of stops and placesby each device, we label places as home, work or third place visits in two steps.First, we categorize each visited place as potential home or work based on the part of the day itis visited, the duration of visits and their reappearance in the daily trajectory. The potential homeis where the device spends the most time between 8:00pm and 8:00am on weekdays or at any timeduring the weekend, and the cumulative time spent at the place exceeds 8 hours per week. Placeswhere devices spend the most time between 9:00am and 5:00pm on weekdays (at least 3 hours aweek) are considered as potential workplaces.Second, we time-aggregate device trajectories to monthly visitation patterns. Thus, we identifyhome and work of a device in a month by the mean coordinate pairs of weekly potential homeand work places, but only in case a device stops at the place at least 10 times over a month and the4Avg number of home locationsPopulation101100102103104105102EReal estate prices(million HUF)All census tractsHome locationsDensity1070.00.51.01.52.02.5108FAvg number of third place visits250 500 750 1000 1250DAvg number of home locations50 100 150 200CBReal estate prices (million HUF)20 40 60 80Third placeWorkHomeStayATripFigure 1: Identifying home locations and third places visits from daily mobility trajectories. (A) Exampletrajectory to illustrate the stop detection process. (B) Identified stops and predicted home, work, and vis-ited third places. (C) Average number of home location and (D) average number of third place visits over24 months by urban neighborhoods of Budapest. (E) The relationship between average number of homelocations over 24 months and population of urban neighborhoods in Budapest. (F) Real estate prices atcensus tracts of identified home locations and across all census tracts of Budapest.5standard deviation of both latitude and longitude coordinates are smaller than 0.001 (about 100meters in Budapest) over the respective month. We categorize every other visited place as a thirdplace, in case it is labeled by the stop detection algorithm as a unique place, but it is not the homeor the work place of the device in the respective month. Figure 1C presents the average number ofdevices with identified home location (and at least one visited third place) and Figure 1D illustratesthe average number of third place visits over the 24-month period aggregated to the level of urbanneighborhoods.Home locations and third places are joined to other data sources with Uber’s Hexagonal Hierar-chical Spatial Index (H3) Uber Technologies, Inc. 2022. The applied indexes of size 10 H3 hexagonsrefer to an average 15.000 m2 area, which is close to the buffer area of a point with a 70 meterradius. We connect all the identified home locations and third places to hexagons and split eachneighborhood or census tract level polygons to the same hexagon size for efficient combination.To infer the socio-economic status of the followed devices, we join home locations to censustract level real estate prices. In Hungary, information on income is not part of the census data col-lection. We rely on residential real estate sales contracts from 2013-2019 collected by the HungarianCentral Statistical Office and predict real estate prices to each census tract of Budapest. Section 2in the Supplementary information introduces the prediction process in detail. Figure 1F presentsthat real estate prices at the identified home locations and across all census tracts are closely align.3 Measuring amenity complexityTo describe the attractiveness of urban locations, we construct the measures of amenity complexity.These indicators are based on the spatial distribution of amenities, which is studied through pointof interest (POI) data from the Google Places API. Besides its limitations in terms of timescale andPOI categorization, it is one of the world’s most popular mapping service supporting applicationsworldwide and helping millions of individuals on a daily basis to find the location of businesses.This makes Google data attractive to study the spatial organization of amenities inside cities (Hi-dalgo, Castañer, and Sevtsuk 2020; Kaufmann et al. 2022; Heroy et al. 2022).We collected GPS coordinates and amenity category for all the POIs around the city of Bu-dapest in early 2022. The 
resulted data set contains 63.601 POIs in 78 different amenity categories.We removed the frequently appearing and ambiguous categories of ATM (1.054 POIs) and Park-ing (729 POIs) and filter out the category Casino with less than 2 POIs in Budapest. We use thisdata to illustrate the amenity profile of the 207 urban neighborhoods of Budapest (Hungarian Cen-tral Statistical Office 2022). Neighborhoods of Budapest are between districts and census tracts inthe spatial hierarchy, which makes them a suitable spatial scale for our analysis (Natera Orozcoet al. 2020). They have an average population of 10.000 people (standard deviation around 10.000),have an average area of 2.5 km2 (standard deviation around 3.9) and on average they consist of 41lower level census tracts (standard deviation around 50). Further description about the neighbor-hoods of Budapest can be found in section 3 of the Supplementary information.6Every neighborhood in Budapest with at least 2 amenity categories that have minimum 2 POIsare considered in the analysis. Alternative specifications and their influence on amenity complex-ity measurement can be found in section 4 of the Supplementary Information. Figure 2A presentsthe resulted 75 amenity categories and the number of POIs across the focal 200 neighborhoodsof Budapest. The most frequent categories are convenient store (5.989 observations), beauty salon(4.461 observations) and restaurant (3.727 observations), while we observe less than 10 amusementpark, bowling alley and city hall. Figure 2B illustrates the unequal spatial distribution of POIs onthe map of neighborhoods in Budapest.To describe the relative importance of amenity categories and illustrate the differences betweenthe amenity structure of neighborhoods, we adopt the economic complexity index (ECI) and theproduct complexity index (PCI) (Hidalgo and Hausmann 2009). The ECI is successfully used todescribe the economic development of countries and regions (Hidalgo 2021) and its approach isadoptable to amenities and urban neighborhoods. We measure amenity complexity the followingway. We normalize the matrix of Figure 2A to make comparisons appropriate between neighbor-hoods and amenity categories and compute the revealed comparative advantage (RCA) of neigh-borhoods in amenity categories by the following standard equation (also known as the Balassaindex):RCAn,a = (Pn,a/Pa)/(Pn/P ) (1)where Pn,a is the number of POIs in neighborhood n in amenity category a and missing indicesindicate summed variables such as Pa =∑a Pn,a. RCA >= 1 suggests that neighborhood n isspecialized in amenity category a. In other words, an amenity category is overrepresented in aneighborhood in case its RCA value is above or equal to 1. We use the RCA values to create abinary specialization matrix Mn,a the following way:Mn,a ={1 if RCAn,a >= 10 if RCAn,a < 1(2)Figure 2C illustrates the resulted binary RCA matrix of neighborhoods and amenity categoriesin Budapest. Sum of rows in this matrix presents the number of amenity categories a neighbor-hood has comparative advantage in (amenity diversity) and the column sums give the number ofneighborhoods where an amenity category is overrepresented (amenity ubiquity).Amenity diversity =Mn =∑aMn,a (3)Amenity ubiquity =Ma =∑nMn,a (4)In geographic matrices like M the average ubiquity of the activities present in a location tends tocorrelate negatively with the diversity of activities in a location. This is the result of the matrixproperty known as nestedness and this feature is utilized to explain that more complex activi-7Amenity diversityAverage amenity ubiquity4050607080901001100 10 20 30 40Neighborhood complexity-3-2-1012FAmenities sorted bytheir complexityNeighborhoods sorted by their complexity Amenity complexity-4-20246HAmenity ubiquityAverage amenity diversity1015202530400 50 100 150Amenity complexity-4-20246GNeighborhoodsAmenitiesRCANeighborhoodsNeighborhoodsMnn' AmenitiesAmenitiesMaa' C EDNeighborhoodsAmenitiesNumber of POIs1 10 100Number of POIs10 100 1000Convenience storeRestaurantHotel and lodgingDoctorBarPharmacyLawyerCar dealerFloristMuseumGas stationCar rentalLibraryLaundrySpa & MassageCemeteryMovie TheaterAirportZooCity hallA BFigure 2: Constructing the measures of neighborhood and amenity complexity. (A) Distribution of point ofinterests (POIs) across neighborhoods and amenity categories. (B) Map of urban neighborhoods colored bythe number of observed POIs. (C) Revealed comparative advantage (RCA) values transformed to a binaryspecialization matrix (M). (D) Similarity matrix of neighborhoods based on their specialization in amenitycategories. This matrix is used to measure neighborhood complexity. (E) Similarity matrix of amenitiesbased on their specialization in neighborhoods. This matrix is used to measure amenity complexity. (F)Relationship between amenity diversity and average amenity ubiquity in neighborhoods. Dots (neigh-borhoods) are colored by their neighborhood complexity value. (G) Relationship between ubiquity andaverage diversity of amenities. Dots (amenity categories) are colored by their amenity complexity value.(H) Neighborhoods with higher complexity value are specialized in amenity categories that have a higheramenity complexity value. Each cell in the matrix represents a neighborhood specialized in an amenitycategory and cells are colored by amenity complexity.ties are only available at a handful of locations with a diverse portfolio of activities (Hidalgo and8Hausmann 2009; Balland et al. 2020).Neighborhood complexity = Kn =1Mn∑aMn,aKa (5)Amenity complexity = Ka =1Ma∑nMn,aKn (6)The economic complexity index (ECI) that describes the production structure of economies andthe product complexity index (PCI) that describe the complexity of products were originally de-fined through the iterative, self-referential algorithm of the ’method of reflection’ (Hidalgo andHausmann 2009). The algorithm calculates the above explained diversity and ubiquity vectorsand then recursively uses the information in one equation to correct the other (see 5) and (6). Laterit was presented that the method of reflection is equivalent to finding the eigenvectors of the sim-ilarity matrix Mnn′ and Maa′ (Mealy, Farmer, and Teytelboym 2019; Hidalgo 2021). In our caseMnn′ is defined from the original binary neighborhood-amenity matrix M as Mnn′ =MT ∗M . Theneighborhood-neighborhood similarity matrix used to construct our neighborhood complexity mea-sure is visualized by Figure 2D. Neighborhood complexity is analogous to economic complexityand it captures the amenity complexity of neighborhoods. To measure the complexity of amenitycategories based on their geographic distribution across neighborhoods, we create an amenity-amenity similarity matrix as Maa′ =M ∗MT , visualized by Figure 2E. The network representationand the clustered version of this matrix can be found in Section 5 in the Supplementary informa-tion. Our amenity complexity measure is analogous to the product complexity index.Applying the most common approach to measure complexity from geographical matrices, wetake the second eigenvector of Mnn′ , which is the leading correction to the equilibrium distribu-tion and is the vector that is the best at dividing neighborhoods into groups based on the amenitiesthat are present in them. Similarly, we take the second eigenvector of Maa′ to get the amenity com-plexity values of amenity categories. This process to measure complexity is similar to dimensionreduction techniques (singular value decomposition) that provide ways to explain the structure ofmatrices (for an overview, see (Hidalgo 2021)).Figure 2F illustrates the relationship between amenity diversity and average amenity ubiquityof neighborhoods. Each point represents a neighborhood and is colored by the derived neighbor-hood complexity values. Besides the expected negative correlation between amenity diversity andaverage amenity ubiquity (Hidalgo 2021), neighborhood complexity and the diversity of ameni-ties at these locations shows remarkable variance. Figure 2G presents the relationship betweenthe ubiquity of amenity categories and their average diversity. Each point stands for an amenitycategory and is colored by the derived amenity complexity values. Overall, we observe that morecomplex amenity categories are non-ubiquitous and on average appear in more diverse areas.However, the figure indicates a clear outlier (bottom left corner), zoo, which is very non-ubiquitousand at the same time appears in less diverse neighborhoods. Figure 2H visualizes the mechanicalrelationship between amenity complexity and neighborhood complexity. The figure makes it clear9that complex neighborhoods have complex amenities. These patterns are in line with the ones re-vealed by Mealy, Farmer, and Teytelboym (2019) for countries and exported products. Section 6 inthe Supplementary information presents the ranking of neighborhoods and amenities in Budapestby their neighborhood complexity and amenity complexity values.10 20 30POIs in neighborhood (log) 10 100 1000Average amenity ubiquity50 75 100Neighborhood complexity-2 0 2AD E FCBAmenity diversityAverage amenity ubiquity4060801005 10 15Centrality of locationNeighborhood complexityCentrality of location5 10 15-202-3Centrality of locationAmenity diversity01020305 10 15Figure 3: Components of neighborhood complexity and their relationship with geographical centrality inBudapest. (A) Map of Budapest colored by the amenity diversity, (B) by the average amenity ubiquity, (C)by the amenity complexity of neighborhoods. (D) Relationship between the geographical centrality andneighborhoods’ amenity diversity, (E) average amenity ubiquity, (F) and neighborhood complexity.Figure 3A, B and C presents amenity diversity, average amenity ubiquity and neighborhoodcomplexity on the map of Budapest, while Figure 3D, E and F illustrates their correlation with thegeographical centrality of neighborhoods in the city. We define geographical centrality of locations(both in case of neighborhoods and actual amenities) by measuring the average distance to reachthe centroid of the location from the center of every census tract in Budapest. Since census tracts arerelatively homogeneous in terms of population, but heterogeneous in their area, this measure givesus lower values for more densely populated, central locations around the historical city center. Insection 7 of the Supplementary information we describe our geographical centrality measure indetail and compare with alternative indices.Figure 3 suggests that all three variables correlate with central location, but the correlation10is stronger for the average amenity ubiquity (0.460) and neighborhood complexity (-0.418). Fig-ures 4A, B and C illustrate actual amenities on a zoomed in map of inner Budapest through size10 H3 hexagons colored by the average diversity, ubiquity and amenity complexity of amenitycategories at the location. At dense inner locations of the city, some hexagons contain amenitiesin multiple amenity categories. The identification of the dominant amenity category is detailedin section 8 of the Supplementary information. Figures 4D, E and F show how average amenitydiversity, amenity ubiquity and amenity complexity are associated with central location. Whileaverage diversity and ubiquity of amenities have no clear connection to urban centrality (correla-tions are -0.038 and 0.113), Figure 4F suggests that complexity amenities tend to be located aroundthe city center (correlation is -0.205, with three remarkable outliers).Centrality of location Centrality of locationAverage amenity diversityAmenity ubiquityAmenity complexityAverage amenity diversity Amenity ubiquity10 20 30 -5 0 550 100Centrality of locationAmenity complexityPOIs in category (log) 10 100 1000AD E FCB7.5 10.0 12.50501005.0 7.5 10.0 12.5-5055.01020307.5 10.0 12.55.0Figure 4: Components of amenity complexity and their association with geographical centrality in Bu-dapest. (A) Amenities colored by their average amenity diversity, (B) by their amenity ubiquity, (C) and bytheir amenity complexity in the map of the city center. (D) Relationship between the geographical central-ity of locations and average diversity, (E) ubiquity, and (F) complexity of amenity categories. Each dot isan amenity category and centrality of location is a category average.114 Results4.1 Diversity of visitors to complex urban neighborhoodsTo illustrate the properties of urban locations that attract people of diverse socio-economic status,we combine our neighborhood complexity index with more granular visitation patterns from mo-bility data. Figure 5 presents our process to join data sources through the example neighborhoodof Középső-Ferencváros.Neighborhood complexityDensityVisitors in neighborhoodsDensityReal estate price at home location (million HUF)DensityAll census tractsCensus tractsof visitors0.00.10.20.3-4 -2 0 2 107 108D FE100 101 102 103 1040.00.20.40.60.00.51.01.52.02.5BHome of visitorsA CKözépső-Ferencváros20 40 60 80Real estate prices at home locations (million HUF)Figure 5: Neighborhood complexity and visitors to an example neighborhood in February 2020. (A) Se-lected urban neighborhood of Középső-Ferencváros. (B) Home location of devices visiting Középső-Ferencváros. (C) Real estate prices at the home location of visitors. (D) Distribution of neighborhood com-plexity values. The red vertical line indicates the complexity of the selected neighborhood of Középső-Ferencváros. (E) Distribution of observed visitors in neighborhoods. The red vertical line indicates thenumber of visitors in the selected neighborhood. (F) Distribution of real estate prices across all censustracts and at the home census tracts of visitors to the selected neighborhood.Figure 5A presents the location of the selected neighborhood, while Figure 5B visualizes thehome location of devices that visited any third places in Középső-Ferencváros during the monthof February 2020. We connect the home location of visitors to census tracts as Figure 5C illustrates.This allows us to infer the socio-economic status of visitors reflected by the real estate prices atthe census tract of their home location. Figure 5D shows that the amenity mix at the selectedneighborhood is relatively complex, while Figure 5E and F shows that Középső-Ferencváros isvisited by more devices than most neighborhoods in February 2020 and its visitors come fromdiverse census tracts from all around Budapest.12Coefficient of variation(1) (2) (3) (4) (5)Neighborhood complexity 0.120∗∗∗ 0.119∗∗∗(0.035) (0.037)Amenity diversity −0.142∗ −0.157∗∗(0.075) (0.073)Avg amenity ubiquity −0.051 −0.018(0.048) (0.049)Centrality of location (log) −0.324∗∗∗ −0.242∗∗∗ −0.322∗∗∗ −0.311∗∗∗ −0.235∗∗∗(0.060) (0.063) (0.060) (0.061) (0.063)Population (log) −0.049∗∗ −0.044∗∗ −0.045∗∗ −0.043∗ −0.038∗(0.022) (0.022) (0.022) (0.023) (0.022)Nr visitors (log) 0.042 0.033 0.049∗ 0.039 0.040(0.029) (0.028) (0.029) (0.029) (0.028)Nr POIs (log) 0.001 0.006 0.046 −0.012 0.052(0.023) (0.022) (0.033) (0.026) (0.034)Constant 0.797∗∗∗ 0.639∗∗∗ 0.734∗∗∗ 0.818∗∗∗ 0.577∗∗∗(0.071) (0.083) (0.078) (0.074) (0.095)Observations 186 186 186 186 186R2 0.277 0.321 0.292 0.282 0.338Adjusted R2 0.261 0.302 0.272 0.262 0.312Note: ∗p<0.1; ∗∗p<0.05; ∗∗∗p<0.01Table 1: Controlled correlations between the socio-economic diversity of visitors and the amenitycomplexity of neighborhoods13To capture socio-economic mixing at urban locations, we measure the diversity of visitors ineach neighborhood for every month by calculating the coefficient of variation (ratio of standarddeviation to the mean) of the real estate prices at the home census tracts of visitors. We focusonly on neighborhoods with at least 10 observed visitors in the focal month to get meaningfulmeasures. Table 1 presents controlled correlations testing the relationship between the diversityof visitors and the amenity structure of neighborhoods using simple OLS regressions on February2020 data. Model (1) is our baseline model that illustrates the relationship between the diversity ofvisitors and the centrality of neighborhoods, while controlling for population, number of visitorsand number of POIs in neighborhoods. The negative and significant coefficient for urban cen-trality suggests that central neighborhoods that are on average less 
distant from the census tractsof Budapest are visited by more diverse people. Model (2) builds on the same model structure,but includes neighborhood complexity as an explanatory variable. It suggests that neighborhoodcomplexity has positive and significant correlation with the diversity of visitors, while taking intoaccount, among other things, the urban centrality of neighborhoods. Interestingly, the diversityof amenities shows a mere negative correlation, while the average ubiquity of amenities is notcorrelated with socio-economic diversity of visitors in our case (see models (3) and (4) in Table 1).Model (5) includes all the key explanatory variables and highlight the stable, significant connectionbetween neighborhood complexity and the diversity of visitors.Using the Gini coefficient or the Theil index to capture the diversity of visitors, we get the sameresults. Related model outputs can be found in section 9 of the Supplementary information. Werun the same models presented in Table 1 on the visitation patterns of non-local users only and ob-serve similar results. In this setting we only consider users living outside the focal neighborhood.Related models are presented in section 10 of the Supplementary information.Furthermore, the relationship between neighborhood complexity and socio-economic diversityof visitors is estimated for each of the available 24 months using the setting of model (2) in Table 1.The related figure in section 11 of the Supplementary information suggests that neighborhoodcomplexity has a positive and significant relationship with the diversity of visitors to neighbor-hoods in 16 out of the available 24 months. The possible reasons behind the uneven coefficientsare discussed in section 5.Both Figure 3 and Figure 4 suggest that our neighborhood and amenity complexity measuresare correlated to urban centrality. Indeed, neighborhood complexity and amenity complexity arederived from the spatial distribution of amenities and then used to explain visits to spatial units,which may raise spatial autocorrelation and endogeneity problems (Broekel 2019; Salinas 2021).We address potential endogeneity issues by applying two different instrumental variable (IV) ap-proaches. Results of IV regressions presented in section 12 of the Supplementary information fur-ther strengthen our argument that neighborhood complexity is connected to the socio-economicdiversity of visitors.144.2 Diversity of visitors to complex amenitiesTo go beyond the level of neighborhoods, we combine amenity complexity measured at the amenitycategory level with visitations to actual amenities derived from our fine-grained mobility data.Figure 6 presents our process to join data sources at the level of amenities through an examplebar in the neighborhood of Középső-Ferencváros, Budapest. The selected amenity is surroundedby other amenities (Figure 6A) and by detecting the home location of visitor devices (in Figure 6Bwe use February 2020 data and the surrounding area in size 10 H3 hexagons), we can observe thesocio-economic status of visitors proxied by real estate prices (Figure 6C). Our Bar example is arelatively complex amenity category (Figure 6D) and is very frequently visited in comparison toother observed amenities in February 2020 (Figure 6E). In addition, visitors from census tracts withmedium or higher real estate prices are over-represented in February 2020, as shown in Figure 6F.DensityVisitors of amenitiesDensityReal estate price at home location (million HUF)DensityAll census tractsCensus tractsof visitors0.000.050.100.150.00.51.01.50123-5 0 5 10-10 100 101 102 103 107 108D FE15 20 25 30Amenity complexityA B CHome of visitors Real estate prices at home locations (million HUF)Selected amenityFigure 6: Connecting amenity complexity to visitor diversity. (A) Selected bar on a map. Light red colorhexagons indicate other nearby amenities. (B) Neighboring home location of visitors. (C) Real estate pricesin the census tract of the visitor home locations. (D) Distribution of amenity complexity values. The redvertical line indicates the amenity complexity of bar, the selected amenity category. (E) Distribution of vis-itors to observed amenities in February 2020, Budapest. The red vertical line indicates the number of vis-itors at the selected bar. (F) Distribution of real estate prices in all census tracts and in census tracts whereselected bar visitors live.We measure the socio-economic diversity of visitors to each amenity for every month by calcu-lating the coefficient of variation (ratio of standard deviation to the mean) of the real estate pricesat the home census tracts of visitors. To do so, we focus only on amenities with at least 10 observed15visitors in the focal month that helps us avoid meaningless values of the indicator. Table 2 presentssimple OLS models to illustrate the relationship between the socio-economic diversity of visitorsand components of amenity complexity at the level of amenities in February 2020. All our modelsat the level of amenities present clustered standard errors at the level of amenity categories.We find in Model (1) that geographical centrality is a significant predictor of socio-economicmixing at amenities, even after controlling for the total number of POIs in the respective amenitycategory across Budapest and the observed number of visitors to the amenity in the focal month.Model (2) presents that amenity complexity has an additional positive and significant relationshipwith the socio-economic mixing. The negative and significant coefficient of amenity ubiquity inModel (3) suggests that rare amenities are visited by more diverse groups of people. This result isconsistent with the findings of Moro et al. (2021). The positive and slightly significant coefficienton the average diversity of amenities in Model (4) indicates that amenity categories that mostlyappear in diverse neighborhoods attract visitors with different socio-economic status. Model (5)includes all the key explanatory variables and highlight the stable, significant connection betweenamenity complexity and the diversity of visitors.Coefficient of variation(1) (2) (3) (4) (5)Amenity complexity 0.067∗∗∗ 0.039∗∗∗(0.016) (0.015)Amenity ubiquity −0.069∗∗∗ −0.049∗∗∗(0.015) (0.018)Avg amenity diversity 0.046∗∗ −0.006(0.023) (0.018)Centrality of location (log) −0.318∗∗∗ −0.295∗∗∗ −0.299∗∗∗ −0.314∗∗∗ −0.292∗∗∗(0.025) (0.023) (0.023) (0.024) (0.023)Nr POIs in category (log) −0.013 −0.006 0.014 −0.001 0.009(0.009) (0.007) (0.009) (0.009) (0.008)Nr visitors (log) 0.073∗∗∗ 0.069∗∗∗ 0.068∗∗∗ 0.071∗∗∗ 0.067∗∗∗(0.007) (0.007) (0.007) (0.007) (0.007)Constant 0.590∗∗∗ 0.517∗∗∗ 0.530∗∗∗ 0.540∗∗∗ 0.511∗∗∗(0.047) (0.037) (0.034) (0.045) (0.036)Observations 2,742 2,742 2,742 2,742 2,742R2 0.109 0.114 0.114 0.110 0.116Adjusted R2 0.108 0.113 0.113 0.109 0.114Note: ∗p<0.1; ∗∗p<0.05; ∗∗∗p<0.01Standard errors are clustered at the amenity category level.Table 2: Controlled correlations between the socio-economic diversity of visitors and amenitycomplexityResults with alternative measures for location centrality can be found in section 7 of the Sup-16plementary information. Changing the dependent variable to the Gini coefficient or the Theilindex to capture the diversity of visitors to amenities, we obtain the same results. Related modeloutputs can be found in section 9 of the Supplementary information. The relationship betweenamenity complexity and socio-economic diversity of visitors is estimated for each of the available24 months using the setting of model (2) in Table 2. The related figure in section 11 in the Supple-mentary information presents that amenity complexity has a positive and significant relationshipwith the diversity of visitors to amenities in 16 out of the available 24 months.5 DiscussionIn this work we bring the ideas behind economic complexity metrics to the urban problems of ex-perienced segregation and social mixing. We measure amenity complexity by utilizing the spatialdistribution of point of interests (POIs) inside a city. We combine the information on the complex-ity of neighborhoods and of amenity categories with fine-grained mobility data to illustrate therelationship between the complexity of amenities available in a location and the socio-economicdiversity of its visitors. Focusing on the urban neighborhoods of Budapest, Hungary, we find thatneighborhoods that concentrate a more complex amenity mix attract a bigger diversity of socio-economic groups. Applying the same logic to actual amenities inside Budapest, we also show thatPOIs of more complex amenity categories are visited by larger diversities of strata. However, thediversity and ubiquity of amenities, the two components of amenity complexity, show a less clearrelationship with the socio-economic diversity of visitors. Diversity of amenities shows a surpris-ing negative correlation with visitor diversity, but only at the neighborhood level, while ubiquityof amenities is related to visitor diversity only at the amenity category level.The geographical centrality of urban locations is a strong predictor of socio-economic mixing.Our results illustrate that both neighborhood complexity and amenity complexity correlate withthe geographical centrality of locations. Contrary to previous works (Zhong et al. 2017), we findthat diversity of amenities is less correlated to urban centrality, while amenity ubiquity is only as-sociated with centrality of locations at the neighborhood level. The relationship between amenitycomplexity and centrality of locations has inspired a number of robustness checks, including theuse of instrumental variable regressions (detailed in the Supplementary information), which fur-ther confirm our key finding that amenity complexity is associated with socio-economic diversityof visitors.The general contribution of our paper is that we combine economic complexity concepts withurban mobility research. Constructing the measures of neighborhood and amenity complexityallows us to systematically test the contribution of certain amenity categories and also the amenityportfolio at certain locations to socio-economic mixing in cities. Moreover, we contribute to the lineof research on segregation patterns inside cities by illustrating in a direct fashion based on fine-grained mobility data that centrality of urban locations largely influence socio-economic mixing.Our empirical work has several limitations, but offers promising future research directions.17The study only focuses on the city of Budapest. Budapest is the only large city in Hungary and itclearly has a monocentric structure. Therefore, our findings are limited to this specific context andsimilar empirical works in cities with different size, geography and urban structure are necessaryto assess the generality of our conclusions.Mobility data for our empirical analysis are produced on a monthly basis. Our findings arevalid for 16 of the 24 months available and COVID-19 did not clearly affect the relationship be-tween amenity complexity and the diversity of visitors to urban locations. However, our datadoes not contain enough observations to provide significant results for all the 24 months understudy. Confirming the results with better mobility data is an important future research direction.To construct the amenity complexity measures, we rely on the specific neighborhood struc-ture of Budapest, however, alternative spatial scales in different urban settings are necessary to betested in the future. We believe that the level of neighborhoods is the appropriate spatial scale toconstruct amenity complexity metrics for two reasons. First, the size of the applied spatial unitscan influence the nestedness of the location-amenity matrix used to construct complexity metrics.Co-occurrence of POIs in different amenity categories are less likely in case we consider smallergeographical areas. Neighborhoods are proved to be large enough to produce intuitive results.Second, neighborhoods are very important spatial units of urban life. They are argued to be theenvironment that can influence social capital accumulation and social mobility (Chetty et al. 2022;Chetty, Hendren, and Katz 2016). Moreover, they have clear administrative boarders and peo-ple can identify with them, which makes the interpretation of amenity complexity results moreappealing.The counting of POIs within neighborhoods does not allow differentiation between the ca-pacity or quality of amenities. We have tested unsuccessfully the number of visitors to amenitycategories within neighborhoods as an input rather than the sheer number of POIs. In the fu-ture, similar but more sophisticated data would be needed to measure amenity complexity moreaccurately.In our empirical exercise, we adopted the most commonly used economic complexity indicatorto amenities and neighborhoods. However, several modifications have been suggested to improveeconomic complexity measurement (Tacchella et al. 2012; Mealy, Farmer, and Teytelboym 2019)and the adoption of these methods to the neighborhood scale in urban environments is an apparentfuture research direction.AcknowledgementsSándor Juhász worked on the paper as a Marie Skłodowska-Curie Postdoctoral Fellow at the Com-plexity Science Hub Vienna (grant number 101062606). The work of Balázs Lengyel was financiallysupported by Hungarian National Scientific Fund (OTKA K 138970). The authors acknowledgethe help of Orsolya Vásárhelyi and Luis Guillermo Natera Orozco with the original POI data col-lection. We wish to thank Tom Broekel, Frank Neffke, Gergő Tóth and László Czaller for their18comments and suggestions. We acknowledge the significant assistance of our illustrator SzabolcsTóth-Zs. in finalizing our primary figures. The authors thank the Social Science Computing UnitBudapest, and the Data Bank of the Centre for Economic- and Regional Studies for the contributionin data management.19ReferencesAbadie, A. 2006. “Poverty, political freedom, and the roots of terrorism.” American Economic Review96 (2): 50–56.Angrist, J. D., G. W. Imbens, and D. B. Rubin. 1996. “Identification of Causal Effects Using Instru-mental Variables.” Journal of the American Statistical Association 91 (434): 444–455.Aslak, U., and L. Alessandretti. 2020. “Infostop: Scalable stop-location detection in multi-user mo-bility data.”Athey, S., B. Ferguson, M. Gentzkow, and T. Schmidt. 2021. “Estimating experienced racial segre-gation in US cities using large-scale GPS data.” Proceedings of the National Academy of Sciences118 (46): e2026160118.Balland, P.-A., T. Broekel, D. Diodato, E. Giuliani, R. Hausmann, N. O’Clery, and D. Rigby. 2022.“The new paradigm of economic complexity.” Research Policy 51 (3): 104450.Balland, P.-A., C. Jara-Figueroa, S. G. Petralia, M. P. A. Steijn, D. L. Rigby, and C. A. Hidalgo. 2020.“Complex economic activities concentrate in large cities.” Nature Human Behaviour 4:248–254.Benton-Short, L., and J. R. Short. 2013. Cities and Nature. London: Routledge.Bokányi, E., S. Juhász, M. Karsai, and B. Lengyel. 2021. “Universal patterns of long-distance com-muting and social assortativity in cities.” Scientific Reports 11:20829.Broekel, T. 2019. “Using structural diversity to measure the complexity of technologies.” PLOSONE 14 (5): 1–23.Cagney, K. A., E. York Cornwell, A. W. Goldman, and L. Cai. 2020. “Urban Mobility and ActivitySpace.” Annual Review of Sociology 46 (1): 623–648.Chetty, R., N. Hendren, and L. F. Katz. 2016. “The Effects of Exposure to Better Neighborhoods onChildren: New Evidence from the Moving to Opportunity Experiment.” American EconomicReview 106, no. 4 (April): 855–902.Chetty, R., M. O. Jackson, T. Kuchler, and et al. 2022. “Social capital I: measurement and associa-tions with economic mobility.” Nature 608:108–121.Chi, B., A. Dennett, T. Oléron-Evans, and R. Morphet. 2021. “Shedding new light on residentialproperty price variation in England: A multi-scale exploration.” Environment and Planning B48 (7): 1895–1911.Christaller, W. 1933. Die zentralen Orte in Süddeutschland. Jena: Gustav Fischer.Dong, X., A. J. Morales, E. Jahani, E. Moro, B. Lepri, B. Bozkaya, C. Sarraute, Y. Bar-Yam, and A.Pentland. 2020. “Segregated interactions in urban and online space.” EPJ Data Science 9:1–20.20Engler, S., and D. Weisstanner. 2021. “The threat of social decline: 
income inequality and radicalright support.” Journal of European Public Policy 28 (2): 153–173.Florida, R. 2004. Cities and the Creative Class. New York: Routledge.Glaeser, E. 2012. Triumph of the city: How our greatest invention makes us richer, smarter, greener, health-ier, and happier. New York: Penguin.Heroy, S., I. Loaiza, A. Pentland, and N. O’Clery. 2022. “Are neighbourhood amenities associatedwith more walking and less driving? Yes, but predominantly for the wealthy.” Environmentand Planning B: Urban Analytics and City Science, 1–25.Hidalgo, C. A. 2021. “Economic complexity theory and applications.” Nature Reviews Physics 3:92–113.Hidalgo, C. A., E. Castañer, and A. Sevtsuk. 2020. “The amenity mix of urban neighborhoods.”Habitat International 106:102205.Hidalgo, C. A., and R. Hausmann. 2009. “The building blocks of economic complexity.” Proceedingsof the National Academy of Sciences 106 (26): 10570–10575.Hilman, R. M., G. Iñiguez, and M. Karsai. 2022. “Socioeconomic biases in urban mixing patternsof US metropolitan areas.” EPJ data science 11 (1): 32.Hungarian Central Statistical Office. 2022. Regional Atlas. (Online; accessed on 10 December 2022).https://www.ksh.hu/regionalatlas%5C_administrative%5C_units.Jacobs, J. 1961. The Death and Life of Great American Cities. New York: Random House.Kaufmann, T., L. Radaelli, L. M. Bettencourt, and E. Shmueli. 2022. “Scaling of urban amenities:generative statistics and implications for urban planning.” EPJ Data Science 11:50.Lösch, A. 1954. The Economics of Location. New Haven, CT: Yale University Press.Loughran, K., and J. R. Elliott. 2022. “Unequal retreats: how racial segregation shapes climate adap-tation.” Housing Policy Debate 32 (1): 171–189.Magalhães, L., M. Kuffer, N. Schwarz, and M. Haddad. 2023. “Bringing economic complexity tothe intra-urban scale: The role of services in the urban economy of Belo Horizonte, Brazil.”Applied Geography 150:102837. ISSN: 0143-6228.Mayer, S. E., and C. Jencks. 1989. “Growing up in Poor Neighborhoods: How Much Does it Mat-ter?” Science 243 (4897): 1441–1445.Mealy, P., J. D. Farmer, and A. Teytelboym. 2019. “Interpreting economic complexity.” Science Ad-vances 5 (1): eaau1705.Moro, E., D. Calacci, X. Dong, and A. Pentland. 2021. “Mobility patterns are associated with expe-rienced income segregation in large US cities.” Nature Communications 12 (1): 1–10.21Musterd, S. 2020. Handbook of urban segregation. Edward Elgar Publishing.Natera Orozco, L. G., D. Deritei, A. Vancso, and O. Vasarhelyi. 2020. “Quantifying Life Qualityas Walkability on Urban Networks: The Case of Budapest.” In Complex Networks and TheirApplications VIII, edited by H. Cherifi, S. Gaito, J. F. Mendes, E. Moro, and L. M. Rocha, 905–918. Cham: Springer International Publishing.Noyman, A., R. Doorley, Z. Xiong, L. Alonso, A. Grignard, and K. Larson. 2019. “Reversed ur-banism: Inferring urban performance through behavioral patterns in temporal telecom data.”Environment and Planning B 46 (8): 1480–1498.Oldenburg, R. 1999. The Great Good Place: Cafes, Coffee Shops, Bookstores, Bars, Hair Salons, and OtherHangouts at the Heart of a Community. Boston, MA: Da Capo Press.Pereira, R. H. M., V. Nadalin, L. Monasterio, and P. H. Albuquerque. 2013. “Urban centrality: asimple index.” Geographical Analysis 45 (1): 77–89.Salinas, G. 2021. “Proximity and Horizontal Policies: The Backbone of Export Diversification andComplexity.” IMF Working Paper, 1–31.Snijders, T. A., and R. J. Bosker. 2011. Multilevel Analysis: An Introduction to Basic and AdvancedMultilevel Modeling. 2nd Edition. London, UK: Sage Publishers.Stojkoski, V., P. Koch, and C. A. Hidalgo. 2022. “Multidimensional Economic Complexity: How theGeography of Trade, Technology, and Research Explain Inclusive Green Growth.”Tacchella, A., M. Cristelli, G. Caldarelli, A. Gabrielli, and L. Pietronero. 2012. “A New Metrics forCountries’ Fitness and Products’ Complexity.” Scientific Reports 2 (723): 1–7.Torrats-Espinosa, G. 2021. “Using machine learning to estimate the effect of racial segregation onCOVID-19 mortality in the United States.” Proceedings of the National Academy of Sciences 118(7): e2015577118.Uber Technologies, Inc. 2022. H3. (Online; accessed on 28 November 2022). https://h3geo.org/.Wang, M. 2021. “Polycentric urban development and urban amenities: Evidence from Chinesecities.” Environment and Planning B: Urban Analytics and City Science 48 (3): 400–416.Wang, Q., M. L. S. Nolan Edward Phillips, and R. J. Sampson. 2018. “Urban mobility and neigh-borhood isolation in America’s 50 largest cities.” Proceedings of the National Academy of Sciences115 (30): 7735–7740.Zhong, C., M. Schlapfer, S. Müller Arisona, M. Batty, C. Ratti, and G. Schmitt. 2017. “Revealingcentrality in the spatial structure of cities from human activity patterns.” Urban Studies 54 (2):437–455.22Supplementary informationS1 Mobility data preparationOur GPS based mobility data is provided by a data aggregator company that collects and combinesanonymous location data from users’ smartphone applications. The sample we use for our analysisis an unbalanced panel of GPS pings from 5.2 million devices in Hungary between 2019 June and2021 May. Our raw data consists of a device identifier, a time stamp, a latitude, and a longitudecoordinate, where GPS pings occur. Pings are logged in case an application on a device requestslocation information. Sometimes this is the result of an active behavior such as using a navigationapplication or requesting local weather information. In other cases, pings could be the result ofan application requesting information while running in the background. As a consequence, pingsoccur at irregular intervals. To identify visitation patterns such as home, work or third place visitsto urban locations, we transform and filter our raw GPS trajectory data in several steps. We detailthese steps in the following.As the data contains some pings attributed to the same device that indicate unreasonable be-havior, we start by iteratively removing all ping pairs that signal a movement over 300 kilometersper hour speed. Additionally, we discard all devices that have fewer than 20 pings remaining afterthis initial speed-based filter. These two steps reduce the total ping count from 3.18 billion to 3.13billion and the total unique device count from 5.2 million to 1.88 million.To focus on locations where devices stopped for some time, we run the Infostop stop detectionalgorithm (Aslak and Alessandretti 2020). In short, it classifies GPS pings to trips or stays andclusters stationary points into stops in an effective way. We apply the algorithm with the followingparameter set. r1, the maximum roaming distance allowed for two pings within the same stay isset to 370 meters. r2, the typical distance between two stays in the same destination is set to 140meters. tmin, the minimum duration of a stay is set to 270 seconds, while tmax, the maximumtime difference between two consecutive pings to be considered within the same stay is set to 7200seconds. The minimum number of GPS pings required for stationary points is set to 2.The parameters are calibrated using the Google location history data of 7 consenting individu-als from Budapest, Hungary. We ran our stop detection algorithm on the sample trajectories witha wide range of parameters. We compared the results of the stop detection process to the personal,anecdotal experiences and to the semantic stop detection extracted from Google accounts. Thisexperiment confirmed that the stop detection algorithm and the parameters produce a reasonableset of trips, stays, and destinations. Moreover, the subsequent home and work detection processbuilt on it produced accurate results for our small sample.Using the output of the stop detection process, we further filter the data to devices that haveat least 2 unique destinations with over 4 different stays in each. This reduces the total stop countfrom 100 million to about 80 million, and the unique device count from 1.75 million to about240.000. However, even in this final form, over 2.1 billion pings are used from the original 3.18billion. Our empirical exercise in the end only uses information for each month from devices with23identified home, work and at least a single visited third place inside Budapest.S2 Socio-economic status from census tract level real estate pricesWe infer on the socio-economic status of individuals living in Budapest by connecting their iden-tified home location to residential real estate prices at the census tract level. Approximating socio-economic status through real estate prices has several benefits in comparison to the prevalent so-lution of using household income statistics of urban locations. First, real estate prices are by def-inition connected to places, while it is harder to connect income to locations. Second, real estatestatistics in the census are comprehensive, while income information only reflects on the status ofactive employees.The Hungarian Central Statistical Office collects data on all residential real estate sales contractsand derives information on transaction prices for the entire country. As not every real estate is onthe market and observed contracts sometimes suffer from missing information on the parametersof given properties, direct measurement on lower geographical level is difficult. By utilizing thefact that real estate prices tend to follow a strong multi-level hierarchy as location (and especiallyneighborhoods in Budapest) explains much of the price differences, we train a multi-level randomslope regression model on the observed transaction prices (Chi et al. 2021; Snijders and Bosker2011). To do so, we use real estate transaction contracts between 2013 and 2019. We create apooled setting by correcting prices through the city level house price index published yearly bythe National Bank of Hungary. Our model can be written as:hi,j = β0,j + β1,jsi,j + εi,jβ0,j = β0 + n0,jβ1,j = β1 + n1,j(7)Here hi,j is the logarithm of the individual price of real estate i in neighborhood j. β0,j representshow much the estimated mean house price differs by neighborhoods. Estimated mean neighbor-hood prices are decomposed to β0, the city level mean, and n0,j , the neighborhood deviation fromthis value. To be able to capture differences within neighborhoods, we apply the individual levelparameter si,j that refers to the size (floor area) of real estate i in neighborhood j. Since the effectof floor area can vary between neighborhoods, we train a random slope model. β1,j represents theeffect of floor area in neighborhood j. β1,j is decomposed to a city level slope β1, and the deviationof neighborhood slopes around this value n1,j .Utilizing this model, we predict prices for every real estate captured by the last Hungariancensus in 2010. By taking the mean of the predicted real estate prices at the census tract level,we get a highly granular socio-economic status map for the entire city of Budapest. Figure 7Aillustrates the predicted prices aggregated to the census tract level on the map of Budapest, whileFigure 7B shows the distribution of predicted real estate prices.24Figure 7: Predicted real estate prices at the census tract level around Budapest (A) and the distribution ofreal estate prices aggregated to the census tract level in Budapest (B)25S3 Urban neighborhoods of Budapest, HungaryWe use urban neighborhoods as geographic units to construct our amenity complexity measures.Budapest consists of 207 urban neighborhoods and their place in the spatial scale hierarchy is be-tween districts and census tracts in terms of area and population. The unequal size distribution ofurban neighborhoods are illustrated in Figure 8 and Figure 9. The correlation between populationof urban neighborhoods and the number of census tracts per urban neighborhoods is strong asPearson’s R is 0.979. Further details about neighborhoods can be found at the website of Hungar-ian Central Statistical Office 2022.Figure 8: Population of urban neighborhoods based on the census of 2010 on the map of Budapest (A) andas a distribution plot (B).Figure 9: Number of census tracts per urban neighborhood based on the census of 2010 on the map of Bu-dapest (A) and as a distribution plot(B).26S4 Alternative specifications to construct amenity complexity measuresTo construct our amenity complexity measures, we create a neighborhood-amenity category ma-trix, where we consider every neighborhood in Budapest with at least 2 amenity categories withminimum 2 POIs. The minimum 2 POIs threshold is implemented to reduce noise in our data.We use this matrix to measure the revealed comparative advantage (RCA) of neighborhoods inamenity categories and transform it to a binary specialization matrix (M ) for the calculation ofcomplexity values at the level of neighborhoods and amenity categories, as described in the maintext. Figure 10 presents how the composition ofM would change in case we use alternative thresh-olds for minimum number of POIs per amenity categories in neighborhoods.Figure 10: Stability of RCA values in the binary specialization matrix (M ) by different specifications. (A)Changes in RCA 0/1 values in case we consider every amenity category in each neighborhood with atleast 1 POI. (B) Changes in RCA 0/1 values in case we increase the minimum number of POIs per amenitycategory in neighborhoods from 2 to 3. (C) Changes in RCA 0/1 values in case we increase the minimumnumber of POIs per amenity category in neighborhoods from 2 to 5.Figure 11: Correlation tables for (A) neighborhood complexity and (B) amenity complexity values createdby applying different minimum thresholds on the number of POIs in the neighborhood-amenity categorymatrix.Despite the different thresholds, around 90% of the neighborhood-amenity category matrix isclassified by the same 0/1 RCA value. This suggests that matrix M is relative stable for smaller27Coefficient of variation(1) (2) (3)Neighborhood complexity 0.120∗∗∗(0.035)Neighborhood complexity min 3 POIs 0.130∗∗∗(0.044)Neighborhood complexity min 5 POIs 0.095∗∗(0.039)Centrality of location (log) −0.242∗∗∗ −0.264∗∗∗ −0.295∗∗∗(0.063) (0.062) (0.062)Population (log) −0.044∗∗ −0.027 −0.018(0.022) (0.022) (0.023)Nr visitors (log) 0.033 0.031 0.035(0.028) (0.029) (0.029)Nr POIs (log) 0.006 −0.037 −0.049∗(0.022) (0.025) (0.028)Constant 0.639∗∗∗ 0.697∗∗∗ 0.737∗∗∗(0.083) (0.076) (0.074)Observations 186 184 177R2 0.321 0.292 0.273Adjusted R2 0.302 0.272 0.252Note: ∗p<0.1; ∗∗p<0.05; ∗∗∗p<0.01Table 3: Controlled correlations between the diversity of visitors and the complexity of neighbor-hoods (in February 2020) in cases we apply different minimum thresholds for the number of POIsconsidered in the neighborhood-amenity category matrix.changes in the minimum number of POIs considered. In case we do not introduce any thresholdto construct the matrix M , we classify slightly more neighborhood-amenity category with RCA=1.Figure 11 presents the correlation tables for neighborhood and amenity complexity valuesbased on different minimum thresholds on the number of POIs. The tables suggest that thereis a clear difference in complexity values in case we introduce a minimum threshold and in casewe do not. Without any noise filtering the resulted complexity values have a negative correlationto complexity values constructed from neighborhood-amenity pairs with at least 2 POIs. We opt tochoose the minimum 2 POIs threshold as it results in intuitive complexity values for both neigh-borhoods and amenity categories, but still not too restrictive. Table 3 and Table 4 presents that ourmain results are not influenced by increasing the minimum 2 POIs threshold to minimum 3 or 528Coefficient of variation(1) (2) (3)Amenity complexity 0.067∗∗∗(0.016)Amenity complexity min 3 POIs 0.074∗∗∗(0.020)Amenity complexity min 5 POIs 0.090∗∗∗(0.030)Centrality of location (log) −0.295∗∗∗ −0.298∗∗∗ −0.295∗∗∗(0.023) (0.024) (0.025)Nr POIs in category (log) −0.006 0.011 0.020∗(0.007) (0.009) (0.012)Nr visitors (log) 0.069∗∗∗ 0.067∗∗∗ 0.067∗∗∗(0.007) (0.007) (0.007)Constant 0.517∗∗∗ 0.471∗∗∗ 0.442∗∗∗(0.037) (0.042) (0.055)Observations 2,742 2,740 2,739R2 0.114 0.113 0.114Adjusted R2 0.113 0.112 0.112Note: ∗p<0.1; ∗∗p<0.05; ∗∗∗p<0.01Table 4: Controlled correlations between the diversity of visitors and the complexity of ameni-
ties (in Februar